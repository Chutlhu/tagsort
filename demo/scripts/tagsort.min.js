!function(e){e.fn.tagSort=function(t){var a={selector:".item-tagsort",tagWrapper:"span",displaySelector:!1,displaySeperator:" ",sortType:"exclusive",fadeTime:200};t=e.extend(a,t);var i={generateTags:function(a){var s={},n={elements:[],tags:[]},r=e(document.createElement(t.tagWrapper));return a.each(function(a){$element=e(this);var o=$element.data("item-tags"),c=o.match(/,\s+/)?o.split(", "):o.split(",");e.each(c,function(e,a){var n=a.toLowerCase();s[n]||(s[n]=[],i.container.append(r.clone().text(a))),t.displaySelector!==!1&&$element.find(t.displaySelector).append(e>0?t.displaySeperator+a:a),s[n].push($element)}),n.elements.push($element),n.tags.push(c)}),"inclusive"==t.sortType?s:"exclusive"==t.sortType?n:"single"==t.sortType?s:void 0},exclusiveSort:function(t,a){var s=[[],[]];return e.each(t.elements,function(a,n){var r=!0;i.container.find(".tagsort-active").each(function(i){-1==t.tags[a].indexOf(e(this).text())&&(r=!1,s[0].push(n))}),1==r&&s[1].push(n)}),s},inclusiveSort:function(t,a){var s=[[],[]];return i.container.find(".tagsort-active").each(function(a){e.each(t[e(this).text().toLowerCase()],function(e,t){s[1].push(t)})}),s},showElements:function(a){e.each(a,function(e,a){a.is("visible")||a.fadeIn(t.fadeTime)})},hideElements:function(a){e.each(a,function(e,a){a.is("visible")&&a.fadeOut(t.fadeTime)})},inititalize:function(a){i.container=a,i.container.addClass("tagsort-tags-container");var s=e(t.selector);i.tags=i.generateTags(s,i.container);var n=i.container.find(t.tagWrapper);n.click(function(){var a=n.hasClass("tagsort-active");if(a||s.fadeIn(t.fadeTime),s.fadeOut(t.fadeTime),"single"==t.sortType)if(e(this).hasClass("tagsort-active"))s.fadeIn(t.fadeTime),e(this).removeClass("tagsort-active");else{e(".tagsort-active").removeClass("tagsort-active"),e(this).toggleClass("tagsort-active");var r=i.inclusiveSort(i.tags,s)}else{e(this).toggleClass("tagsort-active");var r="inclusive"==t.sortType?i.inclusiveSort(i.tags,s):i.exclusiveSort(i.tags,s)}r[0].length>0&&i.hideElements(r[0]),r[1].length>0&&i.showElements(r[1])})}};return i.inititalize(this),e(this)}}(jQuery);
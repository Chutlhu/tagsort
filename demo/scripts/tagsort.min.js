!function(e){e.fn.tagSort=function(t){var a={selector:".item-tagsort",tagWrapper:"span",displaySelector:!1,displaySeperator:" ",sortType:"exclusive",fadeTime:200};t=e.extend(a,t);var n={generateTags:function(a){var i={},s={elements:[],tags:[]},r=e(document.createElement(t.tagWrapper));return a.each(function(a){$element=e(this);var o=$element.data("item-tags"),c=o.match(/,\s+/)?o.split(", "):o.split(",");e.each(c,function(e,a){var s=a.toLowerCase();i[s]||(i[s]=[],n.container.append(r.clone().text(a))),t.displaySelector!==!1&&$element.find(t.displaySelector).append(e>0?t.displaySeperator+a:a),i[s].push($element)}),s.elements.push($element),s.tags.push(c)}),"inclusive"==t.sortType?i:"exclusive"==t.sortType?s:"single"==t.sortType?i:void 0},exclusiveSort:function(t,a){var i=[[],[]];return e.each(t.elements,function(a,s){var r=!0;n.container.find(".tagsort-active").each(function(n){-1==t.tags[a].indexOf(e(this).text())&&(r=!1,i[0].push(s))}),1==r&&i[1].push(s)}),i},inclusiveSort:function(t,a){var i=[[],[]];return n.container.find(".tagsort-active").each(function(a){e.each(t[e(this).text().toLowerCase()],function(e,t){i[1].push(t)})}),i},showElements:function(a){e.each(a,function(e,a){a.is("visible")||a.fadeIn(t.fadeTime)})},hideElements:function(a){e.each(a,function(e,a){a.is("visible")&&a.fadeOut(t.fadeTime)})},inititalize:function(a){n.container=a,n.container.addClass("tagsort-tags-container");var i=e(t.selector);n.tags=n.generateTags(i,n.container);var s=n.container.find(t.tagWrapper);s.click(function(){var a=s.hasClass("tagsort-active");if(a||i.fadeIn(t.fadeTime),i.fadeOut(t.fadeTime),"single"==t.sortType){e(".tagsort-active").removeClass("tagsort-active"),e(this).toggleClass("tagsort-active");var r=n.inclusiveSort(n.tags,i)}else{e(this).toggleClass("tagsort-active");var r="inclusive"==t.sortType?n.inclusiveSort(n.tags,i):n.exclusiveSort(n.tags,i)}r[0].length>0&&n.hideElements(r[0]),r[1].length>0&&n.showElements(r[1])})}};return n.inititalize(this),e(this)}}(jQuery);